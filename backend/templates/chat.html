<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot UTH</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        
        /* Tùy chỉnh thanh cuộn nhỏ gọn */
        .scroll-area::-webkit-scrollbar { width: 6px; }
        .scroll-area::-webkit-scrollbar-thumb { background-color: #d1fae5; border-radius: 4px; }
        
        /* Chiều cao khung chat chính */
        #chat-history { height: calc(100vh - 180px); }
        
        /* Style cho session đang chọn */
        .session-item.active { background-color: #ecfdf5; border-left: 4px solid #047857; color: #047857; font-weight: 600; }
        
        /* Hiệu ứng tin nhắn xuất hiện */
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- HIỆU ỨNG CUỘN THÔNG BÁO DỌC (Auto Scroll) --- */
        @keyframes scroll-vertical {
            0% { transform: translateY(0); }
            100% { transform: translateY(-50%); } /* Dịch 50% vì nội dung được nhân đôi trong JS */
        }
        .animate-vertical-scroll {
            animation: scroll-vertical 20s linear infinite; /* Chạy vòng lặp trong 20s */
        }
        /* Dừng lại khi rê chuột vào để đọc */
        .animate-vertical-scroll:hover {
            animation-play-state: paused;
        }

        /* Ẩn thanh cuộn cho sidebar phải nhưng vẫn giữ chức năng cuộn */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Ẩn sidebar phải trên mobile */
        @media (max-width: 1024px) { #right-sidebar { display: none; } }
    </style>
</head>
<body class="h-screen flex overflow-hidden bg-slate-50">

    <aside class="w-64 bg-white border-r border-gray-200 flex flex-col hidden md:flex flex-shrink-0">
        <div class="p-4 border-b border-gray-100 flex items-center gap-3">
            <img src="{{ url_for('static', filename='img/logo.png') }}" class="w-9 h-9 rounded-full border border-emerald-100 shadow-sm object-cover" alt="UTH" onerror="this.src='https://placehold.co/40x40?text=UTH'">
            <h2 class="font-bold text-emerald-800 text-lg">Chatbot</h2>
        </div>
        
        <div class="p-3">
            <button onclick="createNewChat()" class="w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl transition text-sm font-bold shadow-md">
                <i class="fa-solid fa-plus"></i> Chat mới
            </button>
        </div>

        <div class="flex-1 overflow-y-auto scroll-area px-3 space-y-1 py-2" id="session-list">
            </div>

        <div class="p-4 border-t border-gray-100 bg-gray-50">
            <div class="flex items-center gap-3 mb-3">
                <div class="w-9 h-9 rounded-full bg-white border border-emerald-200 text-emerald-700 flex items-center justify-center font-bold text-xs shadow-sm">SV</div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-bold text-gray-800 truncate" id="user-name">Sinh viên</p>
                    <p class="text-xs text-gray-500 truncate" id="user-mssv">MSSV</p>
                </div>
            </div>
            <button onclick="logout()" class="w-full flex items-center justify-center gap-2 text-xs text-red-600 hover:bg-white hover:shadow py-2 rounded-lg border border-transparent hover:border-red-100 transition font-medium">
                <i class="fa-solid fa-right-from-bracket"></i> Đăng xuất
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative bg-white min-w-0">
        <div id="chat-header" class="h-16 bg-white border-b flex items-center px-6 justify-between shadow-sm z-10">
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-3">
                    <img src="{{ url_for('static', filename='img/logo.png') }}" class="w-10 h-10 rounded-full border-2 border-emerald-50 shadow-sm object-cover" alt="UTH" onerror="this.src='https://placehold.co/40x40?text=UTH'">
                    <div>
                        <h3 class="font-bold text-gray-800 text-sm md:text-base">Trợ lý ảo UTH</h3>
                        <p class="text-xs text-emerald-600 flex items-center gap-1">
                            <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"></span> Trực tuyến
                        </p>
                    </div>
                </div>
            </div>
            <button onclick="clearHistory()" class="text-gray-400 hover:text-red-500 transition text-sm flex items-center gap-1 px-3 py-1.5 rounded-lg hover:bg-red-50" title="Xóa đoạn chat này">
                <i class="fa-regular fa-trash-can"></i> <span class="hidden sm:inline text-xs font-medium">Xóa chat</span>
            </button>
        </div>

        <div id="chat-history" class="flex-1 overflow-y-auto p-4 md:p-6 space-y-5 bg-slate-50 scroll-area">
            </div>

        <div class="p-4 bg-white border-t border-gray-100">
            <form id="chat-form" class="max-w-4xl mx-auto relative flex gap-3">
                <input type="text" id="chat-input" class="flex-1 bg-gray-50 border border-gray-200 rounded-2xl px-5 py-3 text-sm focus:ring-2 focus:ring-emerald-500 focus:bg-white focus:border-transparent transition outline-none shadow-sm" placeholder="Nhập câu hỏi (Ví dụ: Học phí, Lịch thi)...">
                <button type="submit" id="send-button" class="bg-emerald-600 hover:bg-emerald-700 text-white w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg transition-all active:scale-95 flex-shrink-0">
                    <i class="fa-solid fa-paper-plane text-lg"></i>
                </button>
            </form>
        </div>
    </main>

    <aside id="right-sidebar" class="w-80 bg-emerald-50/30 border-l border-gray-200 flex flex-col flex-shrink-0">
        
        <div class="px-5 pt-5 pb-2 border-b border-emerald-50">
            <h3 class="font-bold text-emerald-800 text-sm flex items-center gap-2">
                <span class="w-6 h-6 rounded-full bg-emerald-600 text-white flex items-center justify-center text-xs font-serif italic">i</span>
                Thông báo quan trọng
            </h3>
        </div>

        <div class="flex-1 overflow-hidden relative p-5 pt-2">
            <div class="absolute top-0 left-0 right-0 h-4 bg-gradient-to-b from-[#f2fcf8] to-transparent z-10 pointer-events-none"></div>
            <div class="absolute bottom-0 left-0 right-0 h-4 bg-gradient-to-t from-[#f2fcf8] to-transparent z-10 pointer-events-none"></div>

            <div class="h-full overflow-hidden">
                <div class="animate-vertical-scroll space-y-3">
                    <p class="text-xs text-center text-gray-400 mt-10 animate-pulse">Đang cập nhật tin tức từ trường...</p>
                </div>
            </div>
        </div>

        <div class="p-5 bg-white border-t border-emerald-100 z-20 shadow-[0_-5px_15px_rgba(0,0,0,0.02)]">
            <h3 class="font-bold text-slate-800 text-sm mb-3">Góp ý về trải nghiệm</h3>
            <form id="feedback-form" class="space-y-2">
                <input type="text" id="fb-name" class="w-full text-xs px-3 py-2 border border-slate-200 rounded-lg focus:ring-1 focus:ring-emerald-500 outline-none bg-slate-50" placeholder="Họ tên (Tùy chọn)">
                <textarea id="fb-content" rows="3" class="w-full text-xs px-3 py-2 border border-slate-200 rounded-lg focus:ring-1 focus:ring-emerald-500 outline-none bg-slate-50 resize-none" placeholder="Nội dung góp ý..."></textarea>
                <div class="flex items-center justify-between">
                    <button type="submit" id="fb-submit" class="bg-emerald-600 hover:bg-emerald-700 text-white text-xs font-bold px-3 py-1.5 rounded-lg transition shadow-sm">
                        Gửi phản hồi
                    </button>
                    <span id="fb-status" class="text-[10px] text-emerald-600 font-medium"></span>
                </div>
            </form>
        </div>
    </aside>

    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
</body>
</html>